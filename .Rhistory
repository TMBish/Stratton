# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", y_lab, " : </strong> ' + ", y_form, " + '<br>' + ",
"'<strong>", x_lab, " : </strong> ' + ", x_form,
")}"
)
)
)
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",ylab_form,")}"))),
min = 0,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",xlab_form,")}")))
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", y_lab, " : </strong> ' + ", y_form, " + '<br>' + ",
"'<strong>", x_lab, " : </strong> ' + ", x_form,
")}"
)
)
)
output
lab_format = function(axis) {
if (axis == 'rating'){
format = paste0("this.value + '%'")
} else if (axis == 'intl_revenue') {
format = paste0("'$' + (this.value/1000000).toFixed(0) + 'm'")
}
}
ylab_form = lab_format(axes[1])
xlab_form = lab_format(axes[2])
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",ylab_form,")}"))),
min = 0,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",xlab_form,")}")))
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", y_lab, " : </strong> ' + ", y_form, " + '<br>' + ",
"'<strong>", x_lab, " : </strong> ' + ", x_form,
")}"
)
)
)
output
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",ylab_form,")}"))),
min = 0,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",xlab_form,")}")))
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", y_lab, " : </strong> ' + ", ylab_form, " + '<br>' + ",
"'<strong>", x_lab, " : </strong> ' + ", xlab_form,
")}"
)
)
)
output
library(stringr)
str_replace(y_form, "\.[xy]", "value")
str_replace(y_form, "\\.[xy]", "value")
str_replace(y_form, "\\.[xy]", ".value")
ylab_form = str_replace(y_form, "\\.[xy]", ".value")
xlab_form = str_replace(x_form, "\\.[xy]", ".value")
ylab_form
xlab_form
chart_attributes$x$label = switch(axes[2], "rating" = "Rotten Tomatoes Score"
, "intl_revenue" = "Box Office Revenue")
chart_attributes = list()
chart_attributes$x$label = switch(axes[2], "rating" = "Rotten Tomatoes Score"
, "intl_revenue" = "Box Office Revenue")
chart_attributes
i="x"
chart_attributes[[i]]$label
c_atr = list()
for (i in c("x","y")) {
axis = ifelse(i=="x", 2, 1)
# Axis labels
c_atr[[i]]$label_text = switch(axes[axis],
"rating" = "Rotten Tomatoes Score",
"intl_revenue" = "Box Office Revenue")
# Formmat for the tooltip
c_atr[[i]]$tooltip_form =  tool_format(axes[axis],axis)
# Format for the axes
c_atr[[i]]$label_form = str_replace(c_atr[[i]]$tooltip_form, "\\.[xy]", ".value")
}
c_atr$x$label_text
c_atr$x$label_form
c_atr$x$tooltip_form
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = 0,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}")))
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, " : </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, " : </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
# Need a helper to get it done: Build the javascript tooltip formats
tool_format = function(axis, num) {
dirc = switch(num, "1" = "y", "2" = "x")
if (axis == 'rating'){
format = paste0("this.",dirc," + '%'")
} else if (axis == 'intl_revenue') {
format = paste0("'$' + (this.", dirc, "/1000000).toFixed(0) + 'm'")
}
}
c_atr = list()
for (i in c("x","y")) {
axis = ifelse(i=="x", 2, 1)
# Axis labels
c_atr[[i]]$label_text = switch(axes[axis],
"rating" = "Rotten Tomatoes Score",
"intl_revenue" = "Box Office Revenue")
# Formmat for the tooltip
c_atr[[i]]$tooltip_form =  tool_format(axes[axis],axis)
# Format for the axes
c_atr[[i]]$label_form = str_replace(c_atr[[i]]$tooltip_form, "\\.[xy]", ".value")
}
#++++++++++++++++++
# Build base chart
#++++++++++++++++++
# Cheeky: Grabbed hcaes_string from the dev version of highcharter
# really really handy for me
if (clstr) {
base = hchart(df, "scatter", hcaes_string(x = axes[2], y = axes[1], color = 'cluster'))
} else {
base = hchart(df, "scatter", colour = "#F2B231",hcaes_string(x = axes[2], y = axes[1]))
}
#+++++++++++++++
# Add on extras
#+++++++++++++++
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = 0,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}")))
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, " : </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, " : </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
axis = 2
1.1 * max(df[,axes[axis]])
1.1 * max(df[,axes[1]])
c_atr = list()
for (i in c("x","y")) {
axis = ifelse(i=="x", 2, 1)
# Axis labels
c_atr[[i]]$label_text = switch(axes[axis],
"rating" = "Rotten Tomatoes Score",
"intl_revenue" = "Box Office Revenue")
# Formmat for the tooltip
c_atr[[i]]$tooltip_form =  tool_format(axes[axis],axis)
# Format for the axes
c_atr[[i]]$label_form = str_replace(c_atr[[i]]$tooltip_form, "\\.[xy]", ".value")
# Axis limits
c_atr[[i]]$min = switch(axes[axis],
"rating" = 0,
"intl_revenue" = 0)
c_atr[[i]]$max = switch(axes[axis],
"rating" = 100,
"intl_revenue" = 1.1 * max(df[,axes[axis]]))
}
#++++++++++++++++++
# Build base chart
#++++++++++++++++++
# Cheeky: Grabbed hcaes_string from the dev version of highcharter
# really really handy for me
if (clstr) {
base = hchart(df, "scatter", hcaes_string(x = axes[2], y = axes[1], color = 'cluster'))
} else {
base = hchart(df, "scatter", colour = "#F2B231",hcaes_string(x = axes[2], y = axes[1]))
}
#+++++++++++++++
# Add on extras
#+++++++++++++++
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png") %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = c_atr$y$min,
max = c_atr$y$max,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}"))),
min = c_atr$x$min,
max = c_atr$x$max
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, " : </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, " : </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
shiny::runApp('App')
runApp('App')
runApp('App')
runApp('App')
runApp('App')
base = hchart(df, "scatter", colour = "#F2B231",hcaes_string(x = axes[2], y = axes[1]))
base
base = hchart(df, "scatter", color = "#F2B231",hcaes_string(x = axes[2], y = axes[1]))
base
runApp('App')
runApp('App')
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png",
scatter = list(marker = list(radius = 5))) %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = c_atr$y$min,
max = c_atr$y$max,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}"))),
min = c_atr$x$min,
max = c_atr$x$max
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, ": </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, ": </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
runApp('App')
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png",
scatter = list(marker = list(radius = 5, lineWidth = 1))) %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = c_atr$y$min,
max = c_atr$y$max,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}"))),
min = c_atr$x$min,
max = c_atr$x$max
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, ": </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, ": </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
# Finding Convex Hull Around Cluster
output
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png",
scatter = list(marker = list(radius = 5,
fillColor= '#FFFFFF',
lineWidth= 2,
lineColor= NULL))
) %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = c_atr$y$min,
max = c_atr$y$max,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}"))),
min = c_atr$x$min,
max = c_atr$x$max
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, ": </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, ": </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
output =
# hc_add_series(data = hulls %>% filter(cluster==2),
#               hcaes_string(x = 'intl_revenue', y = 'rating', color = 'cluster'),
#               type = "polygon"
#               ) %>%
base %>%
hc_plotOptions(
divBackgroundImage = "osiris-small.png",
scatter = list(marker = list(radius = 5,
fillColor= '#FFFFFF',
lineWidth= 2,
lineColor= 'null'))
) %>%
hc_yAxis(
title = list(text = y_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$y$label_form,")}"))),
min = c_atr$y$min,
max = c_atr$y$max,
linewidth = 1
) %>%
hc_xAxis(
title = list(text = x_lab),
labels = list(formatter = JS(paste0("function(){return(",c_atr$x$label_form,")}"))),
min = c_atr$x$min,
max = c_atr$x$max
) %>%
hc_title(text = "Test Plot") %>%
hc_subtitle(text = "For Demonstration Purposes Only") %>%
hc_tooltip(useHTML = TRUE, headerFormat = "",
# Lol below looks fucked up
# This hurt my brain so much
formatter = JS(
paste0(
"function(){return (",
"'<strong>' + this.point.title + '</strong> <br>' + ",
"'<strong> Role: </strong>' + this.point.role + '<br>' + ",
"'<strong>", c_atr$y$label_text, ": </strong> ' + ", c_atr$y$tooltip_form, " + '<br>' + ",
"'<strong>", c_atr$x$label_text, ": </strong> ' + ", c_atr$x$tooltip_form,
")}"
)
)
)
output
